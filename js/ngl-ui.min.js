!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("preact"),require("redux")):"function"==typeof define&&define.amd?define(["preact","redux"],t):e.NGLUI=t(e.preact,e.Redux)}(this,function(e,t){"use strict";function o(e){return e&&"asym"!==e&&"0"!==e&&0!==e?"BU"+e:"__AU"}function i(e){return"hydrophobicity"===e?"RdYlGn":"bfactor"===e?"OrRd":"RdYlBu"}function a(e){return"residueindex"===e||"chainname"===e||"hydrophobicity"===e}function n(e){var t=e.colorScheme;return"moleculetype"===t?"moleculetype":"bfactor"===t?"bfactor":"densityfit"===t?ii.sc.structure.validation?"densityfit":"element":"geoquality"===t?ii.sc.structure.validation?"geoquality":"chainname":"element"}function r(e){return e<2e5?"cartoon":"surface"}function l(e){return e<2e5?"residueindex":"chainname"}function s(e,t,o){var i="",a=e.model,n=e.hydrogenVisibility,r=e.ionVisibility,l=e.waterVisibility;return"polymer"===t?"cartoon"===o||"backbone"===o?"all"!==a&&(i="/"+a):"base"===o?(i="polymer and nucleic","all"!==a&&(i+=" and /"+a)):"surface"===o||"spacefill"===o||"licorice"===o?(i="surface"===o&&ii.sizeScore>5e5?".CA":"polymer and ( protein or nucleic )","all"!==a&&(i+=" and /"+a),!1===n&&(i+=" and not hydrogen")):"line"===o||"point"===o?(i="all","all"!==a&&(i+=" and /"+a),!1===n&&(i+=" and not hydrogen"),!1===r&&(i+=" and not ion"),!1===l&&(i+=" and not water")):"ballandstick"===o&&(ii.sc.structure.validation?(i="( "+ii.sc.structure.validation.clashSele+" )","all"!==a&&(i+=" and /"+a),!1===n&&(i+=" and not hydrogen")):i="NONE"):"ligand"===t&&(i="( not polymer or not ( protein or nucleic ) )","all"!==a&&(i+=" and /"+a),!1===n&&(i+=" and not hydrogen"),!1===r&&(i+=" and not ion"),!1===l&&(i+=" and not water")),i}function c(e){var t=e.quality,o=ii.sizeScore;return"auto"===t?o<15e3?12:o<7e4?6:3:"high"===t?12:"medium"===t?6:3}function u(e,t,o){var i=e.quality,a=ii.sizeScore;return"auto"===i?a<15e3?20:a<7e4?10:"polymer"===t&&"cartoon"===o?6:5:"high"===i?20:"medium"===i?10:"polymer"===t&&"cartoon"===o?6:5}function d(e){var t=e.quality,o=ii.sizeScore;return"auto"===t?o<15e3?1:0:"high"===t||"medium"===t?1:0}function p(e){var t=ii.sizeScore,o=e.quality;return"auto"===o?t>25e4:"low"===o}function f(e){var t=e.quality,o=ii.scaleFactor;return"low"===t?.25*o:"medium"===t?.5*o:"high"===t?2*o:1*o}function h(e){e?$("#loading").show():$("#loading").hide()}function y(e){return e===It?Object.assign({},ii.initStateStructureView):e===Ft?Object.assign({},ii.initStateEdmaps):e===xt?Object.assign({},ii.initStateLigandView):e===Rt?Object.assign({},ii.initStateViewer):void 0}function m(){return Object.assign({},y(It),y(Ft),y(xt),y(Rt))}function b(e,t){for(var o=0;o<e.length;o++){var i=e[o];if(0===i.label.indexOf(t))return i.value}return-1}function g(e){for(var t=0;t<e.length;t++){var o=e[t];if(o.value>-1)return o.label}return"None"}function v(e,t){for(var o=0;o<e.length;o++){var i=e[o],a=i.label;if(0===a.indexOf("[")){var n=a.substring(1,a.indexOf("]"));if(console.log("s="+n),n===t)return a.substring(a.indexOf("]")+1)}}return""}function S(e,t,o){t||(t="obj"),void 0===o||o?(console.log("----------------------------------------"),console.log(t+":"),console.log(JSON.stringify(e,null,2)),console.log("----------------------------------------")):console.log(t+": "+JSON.stringify(e))}function k(e,t){if(t||(t="obj"),console.log("========================================"),console.log(t+":"),Array.isArray(e))e.forEach(function(e){return console.log(e)});else if("object"==typeof e)for(var o in e)console.log(o+"="+e[o]);else console.log(e);console.log("========================================")}function C(e){return{assembly:w(),model:_(),symmetry:N(e),style:V(),colorScheme:E(),ligandStyle:T(),quality:O(),mapStyle:I(),ligand:F(),pocketColor:x(),cameraType:R(),background:L()}}function w(){var e=[],t=ii.sc.structure,o=t.biomolDict;if(ii.isFullStructure)B(e,"BU1","Full Structure");else{var i=t.unitcell?"Asymmetric Unit":"Full Structure";B(e,"__AU",i);for(var a in o)"UNITCELL"===a?B(e,a,"Unitcell"):"SUPERCELL"===a?B(e,a,"Supercell"):"BU"===a.substr(0,2)?(i="Bioassembly "+a.substr(2),B(e,a,i)):B(e,a,a)}return e}function _(){var e=[],t=ii.sc.structure.modelStore;t.count>1&&B(e,"all","All Models");for(var o=0;o<t.count;++o)B(e,o,"Model "+(o+1));return e}function N(e){var t=[];if(B(t,-1,"None"),ii.symmetryData[e]){ii.symmetryData[e].symmetries.forEach(function(e,o){B(t,o,e.label)})}return t}function V(){var e=[];return B(e,"","None"),B(e,"backbone","Backbone"),B(e,"surface","Surface"),B(e,"cartoon","Cartoon"),ii.reduced||(B(e,"spacefill","Spacefill"),B(e,"licorice","Licorice")),B(e,"line","Line"),e}function E(){var e=[],t=!0,o=!0,i=!0,a=!1,n=ii.sc.structure.header.experimentalMethods;return n&&(n.includes("X-RAY DIFFRACTION")||n.includes("ELECTRON CRYSTALLOGRAPHY")||n.includes("NEUTRON DIFFRACTION")||(t=!1,o=!1),(n.includes("SOLUTION NMR")||n.includes("SOLID-STATE NMR"))&&(a=!0)),ii.hasValidationReport||(o=!1,i=!1,a=!1),ii.hasEdmaps||(o=!1),B(e,"chainname","By Chain"),B(e,"residueindex","Rainbow"),B(e,"element","By Element/CPK"),B(e,"resname","By Residue"),B(e,"moleculetype","By Molecule Type"),t&&B(e,"bfactor","By B-factor"),B(e,"sstruc","By Secondary Structure"),B(e,"hydrophobicity","By Hydrophobicity"),o&&B(e,"densityfit","By Density Fit"),i&&B(e,"geoquality","By Geometry Quality"),a&&B(e,"randomcoilindex","By NMR Random Coil Index"),e}function T(){var e=[];return B(e,"","None"),B(e,"ballandstick","Ball & Stick"),B(e,"spacefill","Spacefill"),e}function O(){var e=[];return B(e,"auto","Automatic"),B(e,"low","Low"),B(e,"medium","Medium"),B(e,"high","High"),e}function I(){var e=[];return B(e,"contour","Mesh"),B(e,"smooth","Smooth"),B(e,"flat","Flat"),e}function F(){var e=[];if(!ii.reduced){var t=[];ii.sc.structure.eachResidue(function(e){if(!e.isWater()){var o="";void 0!==e.resno&&(o+=e.resno),e.inscode&&(o+="^"+e.inscode),e.chain&&(o+=":"+e.chainname);var i=(e.resname?"["+e.resname+"]":"")+o;t.push([o,i])}},new NGL.Selection("( not polymer or not ( protein or nucleic ) ) and not ( water or ACE or NH2 ) and /0")),t.length>0&&(B(e,"","None"),t.forEach(function(t){B(e,t[0],t[1])}))}return e}function x(){var e=[];return B(e,"hydrophobicity","By Hydrophobicity"),B(e,"element","By Element/CPK"),B(e,"bfactor","By B-factor"),e}function R(){var e=[];return B(e,"perspective","Perspective Camera"),B(e,"orthographic","Orthographic Camera"),e}function L(){var e=[];return B(e,"white","White background"),B(e,"black","Black background"),e}function B(e,t,o){e.push({value:t,label:o})}function A(e,t){var o=t.type;o!==at&&o!==nt&&o!==lt&&o!==pt&&o!==ft&&o!==dt&&o!==Et&&S(t,Gt+": action",!1);var i={autoView:-1,action:t};switch(o){case Me:i.view=t.value;break;case Ue:i.autoView=zt;break;case Ge:var a=t.value,n=N(a);i.assembly=a,i.symmetry=ii.initStateStructureView.symmetry,i.options=Object.assign({},e.options,{symmetry:n}),i.autoView=Pt;break;case qe:i.model="all"===t.value?"all":parseInt(t.value),i.autoView=Pt;break;case We:i.symmetry=parseInt(t.value),i.autoView=Pt;break;case Ye:i.style=t.value;break;case He:i.colorScheme=t.value;break;case Ke:i.ligandStyle=t.value;break;case Qe:i.quality=t.value;break;case $e:i.clashVisibility=t.value;break;case Xe:i.hydrogenVisibility=t.value;break;case Je:i.ionVisibility=t.value;break;case Ze:i.waterVisibility=t.value;break;case et:if(Object.assign(i,m()),i.view=It,e.assembly!==ii.initStateStructureView.assembly){var r=N(ii.initStateStructureView.assembly);i.options=Object.assign({},e.options,{symmetry:r})}i.autoView=Pt;break;case tt:i.map2fofc=t.value,t.value?(i.scroll="2fofc",i.level2fofc=0===e.level2fofc?Dt:e.level2fofc,i.boxSize=e.boxSize<1?Mt:e.boxSize,Object.assign(i,P(Ft))):i.scroll=e.mapFofc?"fofc":"",i.autoView=Pt;break;case ot:i.mapFofc=t.value,t.value?(i.scroll="fofc",i.levelFofc=0===e.levelFofc?jt:e.levelFofc,i.boxSize=e.boxSize<1?Mt:e.boxSize,Object.assign(i,P(Ft))):i.scroll=e.map2fofc?"2fofc":"",i.autoView=Pt;break;case it:var l=t.value;"2fofc"!==l||e.map2fofc?"fofc"!==l||e.mapFofc||(l=e.map2fofc?"2fofc":""):l=e.mapFofc?"fofc":"",i.scroll=l;break;case at:i.level2fofc=parseFloat(t.value);break;case nt:i.levelFofc=parseFloat(t.value);break;case rt:i.mapStyle=t.value;break;case lt:i.boxSize=parseInt(t.value);break;case st:Object.assign(i,z(t.value));break;case ct:Object.assign(i,m(),P(Ft)),i.map2fofc=!0,i.scroll="2fofc",i.level2fofc=Dt,i.boxSize=Mt,i.autoView=Pt;break;case ut:Object.assign(i,z(t.value));break;case dt:i.pocketOpacity=parseInt(t.value);break;case pt:i.pocketNearClipping=parseInt(t.value);break;case ft:i.pocketRadiusClipping=parseInt(t.value);break;case bt:i.pocketColor=t.value;break;case gt:i.hydrogenBond=t.value;break;case vt:i.halogenBond=t.value;break;case St:i.hydrophobic=t.value;break;case kt:i.piInteraction=t.value;break;case Ct:i.metalCoordination=t.value;break;case ht:i.label=t.value;break;case yt:i.polymerDisplay=t.value;break;case mt:Object.assign(i,z(e.options.ligand[1].value));break;case wt:i.spin=!e.spin;break;case _t:i.autoView=Pt;break;case Nt:i.fullscreen=!e.fullscreen;break;case Vt:break;case Et:i.focus=parseInt(t.value);break;case Tt:i.cameraType=t.value;break;case Ot:i.background=t.value;break;default:i.action={type:"UNKOWN TYPE",value:o}}return Object.assign({},e,i)}function z(e){if(""===e)return Object.assign(y(It),y(xt));var t=new NGL.Selection(e),o=ii.sc.structure.getView(t),i=Math.max(o.boundingBox.getSize().length()/2,2)+5,a={ligand:e,ligandSelection:t,pocketRadius:i,boxSize:parseInt(i)};return Object.assign(y(xt),a,P(xt))}function P(e){var t={};return t.assembly=ii.isFullStructure?"BU1":"__AU",e===Ft?(t.style="line",t.colorScheme="element"):e===xt&&(t.assembly=ii.isFullStructure?"BU1":"__AU",t.style=""),t}function D(e,t){e.spin?t.setSpin([0,1,0],.005):t.setSpin(null,null)}function j(){console.log("center")}function M(e,t){t.toggleFullscreen(document.getElementById("ngl-ui"))}function U(e){e.makeImage({factor:2,antialias:!0,trim:!1,transparent:!1}).then(function(e){NGL.download(e,pdbid+"_screenshot.png")})}function G(e,t){t.setFocus(50+.5*e.focus)}function q(e,t){t.setParameters({cameraType:e.cameraType})}function W(e,t){t.setParameters({backgroundColor:e.background})}function Y(e,t){D(e,t),G(e,t),q(e,t),W(e,t)}function H(){var e=ii.sc,t=ii.hasLigand;qt.unitcell=null,qt.polymer={cartoon:e.addRepresentation("cartoon",{lazy:!0,visible:!1,aspectRatio:5,radiusScale:.7}),base:e.addRepresentation("base",{lazy:!0,visible:!1}),backbone:e.addRepresentation("backbone",{lazy:!0,visible:!1,scale:2}),surface:e.addRepresentation("surface",{lazy:!0,visible:!1,surfaceType:"sas",probeRadius:1.4,useWorker:!0}),spacefill:e.addRepresentation("spacefill",{lazy:!0,visible:!1}),licorice:e.addRepresentation("licorice",{lazy:!0,visible:!1,multipleBond:"symmetric"}),ballandstick:e.addRepresentation("ball+stick",{lazy:!0,visible:!1,multipleBond:"symmetric"}),line:e.addRepresentation("line",{lazy:!0,visible:!1,linewidth:5,multipleBond:"offset"}),point:e.addRepresentation("point",{lazy:!0,visible:!1,sizeAttenuation:!1,pointSize:5,alphaTest:1,useTexture:!0})},qt.ligand={spacefill:e.addRepresentation("spacefill",{lazy:!0,visible:!1}),ballandstick:e.addRepresentation("ball+stick",{lazy:!0,visible:!1,scale:2.5,aspectRatio:1.2,radiusSize:.4,colorValue:"grey",multipleBond:"symmetric"})},qt.validation={validation:e.addRepresentation("validation",{lazy:!0,visible:!1,color:"geoquality"}),ballandstick:e.addRepresentation("ball+stick",{lazy:!0,visible:!1,color:"geoquality"})},t&&(qt.ligandView={neighbor:e.addRepresentation("ball+stick",{lazy:!0,visible:!1,sele:"none",aspectRatio:1.1,colorValue:"white",multipleBond:"symmetric"}),contact:e.addRepresentation("contact",{lazy:!0,visible:!1,sele:"none",radius:.07,weakHydrogenBond:!1,ionicInteraction:!1,refineSaltBridges:!1}),pocket:e.addRepresentation("surface",{lazy:!0,visible:!1,sele:"none",opaqueBack:!1,roughness:1,surfaceType:"av"}),label:e.addRepresentation("label",{lazy:!0,visible:!1,sele:"none",color:"#333333",yOffset:.2,zOffset:2,attachment:"bottom-center",showBackground:!0,backgroundColor:"white",backgroundOpacity:.5,disablePicking:!0,radiusType:"size",radiusSize:1,labelType:"residue",labelGrouping:"residue"})})}function K(e,t,o){var i=pdbid.substring(1,3),a=Lt+i+"/"+pdbid+"/"+pdbid+Bt;console.log("validationUrl="+a),NGL.autoLoad(a,{ext:"validation"}).then(function(i){ii.sc.structure.validation=i,o(e,t,!0)}).catch(function(i){console.log("error="+i),o(e,t,!1)})}function Q(e,t){var o=e.assembly,r=e.model,l=e.symmetry,y=e.style,m=e.colorScheme,b=e.ligandStyle,g=e.quality,v=e.clashVisibility,S=e.action;if(!v&&"densityfit"!==m&&"geoquality"!==m&&"randomcoilindex"!==m||ii.sc.structure.validation){if(ii.sc.defaultAssembly=o,console.log(Wt+": update: nglUi.sc.defaultAssembly="+ii.sc.defaultAssembly+" ("+o+")"),"UNITCELL"===o?qt.unitcell||(qt.unitcell=ii.sc.addRepresentation("unitcell",{visible:!0,disableImpostor:!0})):null!==qt.unitcell&&(ii.sc.removeRepresentation(qt.unitcell),qt.unitcell=null),""!==y){var k=qt.polymer[y];k.setSelection(s(e,"polymer",y)),"cartoon"===y?qt.polymer.base.setSelection(s(e,"polymer","base")):"line"===y&&qt.polymer.point.setSelection(s(e,"polymer","point"));var C={assembly:o,colorScheme:m,colorScale:i(m),colorReverse:a(m),scaleFactor:f(e),sphereDetail:d(e),subdiv:c(e),lineOnly:p(e),radialSegments:u(e,"polymer",y)};k.setParameters(C),"cartoon"===y?qt.polymer.base.setParameters(C):"line"===y&&qt.polymer.point.setParameters(C)}if(J(y),""!==b){var w=qt.ligand[b],_={assembly:o,colorScheme:n(e),quality:g,radiusSize:""===e.ligand?.4:.15};w.setParameters(_),w.setSelection(s(e,"ligand",b))}if(X(b),v){var N=ii.sc.structure.validation.clashSele;"all"!==r&&(N="("+N+") and /"+r),!1===e.hydrogenVisibility&&(N="("+N+") and not hydrogen");for(var V in qt.validation){var E=qt.validation[V];E.setSelection(N),E.setVisibility(!0)}}else for(var T in qt.validation)qt.validation[T].setVisibility(!1);-1===l?oe():S.type!==We&&void 0!==ii.symmetryBuffer||ee(e,t),S.type===et&&(Oe(e,t),me(e,t),Y(e,t))}else h(!0),K(e,t,Z)}function Z(e,t,o){h(!1),o&&Q(e,t)}function J(e){for(var t in qt.polymer){var o=qt.polymer[t];"base"===t?o.setVisibility("cartoon"===e):"point"===t?o.setVisibility("line"===e):o.setVisibility(t===e)}}function X(e){for(var t in qt.ligand)qt.ligand[t].setVisibility(t===e)}function ee(e,t){oe();var o=e.assembly,i=e.symmetry;if(e.symmetry>=0&&ii.symmetryData[o]){var a=ii.symmetryData[o].symmetries[i];if(a&&a.axes){var n=a.axes.sort(function(e,t){return e.order<t.order?1:-1});ii.symmetryBuffer=new Yt(n,{}),ii.symmetryBuffer.attach(ii.sc);var r=new(Function.prototype.bind.apply(NGL.Vector3,[null].concat(n[0].start))),l=new(Function.prototype.bind.apply(NGL.Vector3,[null].concat(n[0].end))),s=(new NGL.Vector3).subVectors(r,l).normalize(),c=new NGL.Vector3;n.length>1?(r.set.apply(r,n[1].start),l.set.apply(l,n[1].end),c.subVectors(r,l)):c.set(Math.random(),Math.random(),Math.random()),c.normalize().cross(s).normalize();var u=(new NGL.Vector3).crossVectors(s,c).normalize(),d=new NGL.Matrix4;d.makeBasis(u,c,s),d.determinant()<0&&d.scale(new NGL.Vector3(-1,-1,-1));var p=new NGL.Quaternion;p.setFromRotationMatrix(d),p.inverse(),t.animationControls.rotate(p,1e3)}}}function te(e){var t=new(Function.prototype.bind.apply(NGL.Vector3,[null].concat(e.start))),o=new(Function.prototype.bind.apply(NGL.Vector3,[null].concat(e.end))),i=(new NGL.Vector3).subVectors(t,o);return Math.sqrt(i.length()/200)}function oe(){ii.symmetryBuffer&&(ii.symmetryBuffer.dispose(),ii.symmetryBuffer=void 0)}function ie(e,t){var o=e.ligand;if(Q(e,t),""===o)for(var i in qt.ligandView)qt.ligandView[i].setVisibility(!1);else{var a=ii.sc,n=a.structure,r=e.ligandSelection,l=n.getView(r),s=" and /"+e.model,c=n.getAtomSetWithinSelection(r,5),u=n.getAtomSetWithinSelection(r,e.pocketRadius+2),d=n.getAtomSetWithinGroup(c),p=o+s,f=d.toSeleString(),h="("+f+") and not ("+o+")"+s,y="("+u.toSeleString()+") and not ("+o+") and polymer"+s,m="(("+h+") or ("+o+"))"+s;f+=s,!1===e.waterVisibility&&(p="("+p+") and not water",h="("+h+") and not water",f="("+f+") and not water",y="("+y+") and not water",m="("+m+") and not water"),!1===e.hydrogenVisibility&&(p="("+p+") and not hydrogen",h="("+h+") and not hydrogen",f="("+f+") and not hydrogen",y="("+y+") and not hydrogen",m="("+m+") and not hydrogen"),qt.ligand.ballandstick.setParameters({radiusSize:.15}),qt.ligand.ballandstick.setSelection(p),qt.ligandView.neighbor.setSelection(h),qt.ligandView.contact.setSelection(f),qt.ligandView.pocket.setSelection(y),qt.ligandView.label.setSelection(m),qt.ligandView.contact.setParameters({hydrogenBond:e.hydrogenBond,halogenBond:e.halogenBond,hydrophobic:e.hydrophobic,piInteraction:e.piInteraction,metalCoordination:e.metalCoordination}),qt.ligandView.pocket.setParameters({opacity:e.pocketOpacity,clipNear:e.pocketNearClipping,clipRadius:e.pocketRadius,color:e.pocketColor,clipCenter:l.center});for(var b in qt.ligandView)qt.ligandView[b].setVisibility(!0);ii.hasEdmaps&&(e.map2fofc||e.map2fofc)&&Ee(e),t.tasks.onZeroOnce(function(){return a.autoView(f,zt)})}}function ae(e){qt.ligandView.pocket.setParameters({opacity:e.pocketOpacity/100})}function ne(e){qt.ligandView.pocket.setParameters({clipNear:e.pocketNearClipping})}function re(e){var t=e.pocketRadiusClipping;0===t&&(t=.01);var o=t/100,i=e.pocketRadius*o;qt.ligandView.pocket.setParameters({clipRadius:i})}function le(e){qt.ligandView.pocket.setParameters({color:e.pocketColor})}function se(e){var t=e.hydrogenBond;qt.ligandView.contact.setParameters({hydrogenBond:t,waterHydrogenBond:t,backboneHydrogenBond:t})}function ce(e){qt.ligandView.contact.setParameters({halogenBond:e.halogenBond})}function ue(e){qt.ligandView.contact.setParameters({hydrophobic:e.hydrophobic})}function de(e){var t=e.piInteraction;qt.ligandView.contact.setParameters({cationPi:t,piStacking:t})}function pe(e){qt.ligandView.contact.setParameters({metalCoordination:e.metalCoordination})}function fe(e){qt.ligandView.label.setVisibility(e.label)}function he(e){var t="",o="";e.polymerDisplay&&(t="backbone",o="ballandstick"),ii.store.dispatch({type:Ye,value:t}),ii.store.dispatch({type:Ke,value:o})}function ye(e,t){ie(e,t)}function me(){for(var e in qt.ligandView)qt.ligandView[e].setVisibility(!1)}function be(e,t){e.map2fofc?Ht.surf2fofc?ge(e,t):(h(!0),t.loadFile(At+pdbid+"_2fofc.dsn6").then(function(o){Ie(o),ge(e,t),h(!1)})):(ke(e),Ht.surf2fofc&&Ht.surf2fofc.setVisibility(!1))}function ge(e,t){var o=e.boxSize,i=e.level2fofc,a=e.mapStyle,n={boxSize:o,isolevelScroll:!0,isolevel:i};Object.assign(n,Kt[a]),Ht.surf2fofc.setParameters(n),Ht.surf2fofc.setVisibility(!0),Ht.surfFofc&&(Ht.surfFofc.setParameters({isolevelScroll:!1}),Ht.surfFofcNeg.setParameters({isolevelScroll:!1})),ii.components.boxSize.setState({value:o}),e.action.type!==et&&Re(e,t)}function ve(e,t){e.mapFofc?Ht.surfFofc?Se(e,t):(h(!0),t.loadFile(At+pdbid+"_fofc.dsn6").then(function(o){Fe(o),Se(e,t),h(!1)})):(ke(e),Ht.surfFofc&&Ht.surfFofc.setVisibility(!1),Ht.surfFofcNeg&&Ht.surfFofcNeg.setVisibility(!1))}function Se(e,t){var o=e.boxSize,i=e.levelFofc,a=e.mapStyle,n={boxSize:o,isolevelScroll:!0,isolevel:i};Object.assign(n,Kt[a]),Ht.surfFofc.setParameters(n),Ht.surfFofc.setVisibility(!0),Ht.surfFofcNeg.setParameters(n),Ht.surfFofcNeg.setVisibility(!0),Ht.surf2fofc&&Ht.surf2fofc.setParameters({isolevelScroll:!1}),ii.components.boxSize.setState({value:o}),e.action.type!==et&&Re(e,t)}function ke(e){var t=e.scroll;if(Ht.surf2fofc&&Ht.surf2fofc.setParameters({isolevelScroll:"2fofc"===t}),Ht.surfFofc){var o="fofc"===t;Ht.surfFofc.setParameters({isolevelScroll:o}),Ht.surfFofcNeg.setParameters({isolevelScroll:o})}}function Ce(e){if(Ht.surf2fofc){var t=parseFloat(e.level2fofc);Ht.surf2fofc.setParameters({isolevel:t})}}function we(e){if(Ht.surfFofc&&Ht.surfFofcNeg){var t=parseFloat(e.levelFofc);Ht.surfFofc.setParameters({isolevel:t}),Ht.surfFofcNeg.setParameters({isolevel:t})}}function _e(e){var t=Kt[e.mapStyle];Ht.surf2fofc&&Ht.surf2fofc.setParameters(t),Ht.surfFofc&&(Ht.surfFofc.setParameters(t),Ht.surfFofcNeg.setParameters(t))}function Ne(e){var t=e.boxSize;0===t&&(t=.1);var o={boxSize:t};Ht.surf2fofc&&Ht.surf2fofc.setParameters(o),Ht.surfFofc&&(Ht.surfFofc.setParameters(o),Ht.surfFofcNeg.setParameters(o))}function Ve(e,t){""===e.ligand?me(e,t):(ie(e,t),Ee(e))}function Ee(e){Ne(e),ii.components.boxSize.setState({value:e.boxSize})}function Te(e,t){Q(e,t),me(e,t),be(e,t)}function Oe(e,t){be(e,t),ve(e,t)}function Ie(e){Ht.surf2fofc=e.addRepresentation("surface",{lazy:!0,visible:!1,color:"skyblue",useWorker:!1,contour:!0,opaqueBack:!1,isolevelScroll:!0}),Ht.surf2fofc.signals.parametersChanged.add(function(e){xe(e.isolevel,Ht.surf2fofc,"2fofc")})}function Fe(e){Ht.surfFofc=e.addRepresentation("surface",{lazy:!0,visible:!1,color:"mediumseagreen",useWorker:!1,contour:!0,opaqueBack:!1,isolevelScroll:!0}),Ht.surfFofcNeg=e.addRepresentation("surface",{lazy:!0,visible:!1,color:"tomato",negateIsolevel:!0,useWorker:!1,contour:!0,opaqueBack:!1,isolevelScroll:!0}),Ht.surfFofc.signals.parametersChanged.add(function(e){xe(e.isolevel,Ht.surfFofc,"fofc")}),Ht.surfFofcNeg.signals.parametersChanged.add(function(e){xe(e.isolevel,Ht.surfFofcNeg)})}function xe(e,t,o){if(e<.01)t.setParameters({isolevel:.01});else if(e>10)t.setParameters({isolevel:10});else if(o){var i="2fofc"===o?"level2fofc":"levelFofc";ii.components[i].setState({value:e.toFixed(1)})}}function Re(e,t){var o=ii.isFullStructure?"BU1":"__AU";e.assembly===o&&""===e.style&&""===e.ligandStyle||Q(e,t)}function Le(t,o){var i=[];return o.forEach(function(t){i.push(e.h(jo,{option:t}))}),i}function Be(o){k(ii,"nglUi in "+oi);var i=t.createStore(A,o);ii.store=i,i.subscribe(function(){Ae(i.getState())}),e.render(e.h(ei,{store:i}),document.getElementById("nglControls")),e.render(e.h(ti,{store:i}),document.getElementById("viewer"));var a=i.getState();k(a,"state in "+oi),a.view===xt?i.dispatch({type:ut,value:a.ligand}):a.view===Ft?i.dispatch({type:ct}):i.dispatch({type:Ue}),h(!1),initUi(),stage.signals.parametersChanged.add(function(e){console.log("clipNear="+e.clipNear);var t=Math.max(0,4*e.clipNear-100);ii.components.focus.setState({value:t})})}function Ae(e){var t=e.action.type;t===Me?console.log("setView="+e.view):t===Ue||t===Ge||t===qe||t===We||t===Ye||t===He||t===Ke||t===Qe||t===Ze||t===Je||t===Xe||t===$e||t===et?Q(e,stage):t===tt?be(e,stage):t===ot?ve(e,stage):t===it?ke(e,stage):t===at?Ce(e,stage):t===nt?we(e,stage):t===rt?_e(e,stage):t===lt?Ne(e,stage):t===st?Ve(e,stage):t===ct?Te(e,stage):t===ut?ie(e,stage):t===dt?ae(e):t===pt?ne(e):t===ft?re(e):t===bt?le(e):t===gt?se(e):t===vt?ce(e):t===St?ue(e):t===kt?de(e):t===Ct?pe(e):t===ht?fe(e):t===yt?he(e,stage):t===mt?ye(e,stage):t===wt?D(e,stage):t===_t?j(stage):t===Nt?M(e,stage):t===Vt?U(stage):t===Tt?q(e,stage):t===Ot?W(e,stage):t===Et?G(e,stage):S(e.action),-1!==e.autoView&&stage.tasks.onZeroOnce(function(){console.log(oi+": updateNglUi: sc.defaultAssembly="+ii.sc.defaultAssembly),stage.autoView(e.autoView),ii.sc.autoView(),ii.init&&(console.log("~~~~~~~~~~ updateNglUi: "+(Date.now()-startTime)+"ms after startTime"),ii.init=!1)}),ii.components.nglControls.setState(),ii.components.viewer.setState()}function ze(e){var t={};return e&&e.length>0&&e.forEach(function(e){var o=0===e.biologicalAssemblyId?"__AU":"BU"+e.biologicalAssemblyId,i=[];if(e.localSymmetry){var a={};e.localSymmetry.forEach(function(e){var t=e.symmetry;if("C1"!==t){var o={label:t+" (local)",axes:e.symmetryAxes};i.push(o),a[t]||(a[t]=[]),a[t].push(o)}});for(var n in a){var r=a[n];r.length>1&&r.forEach(function(e,t){e.label+=" ("+(t+1)+")"})}}e.globalSymmetry&&"C1"!==e.globalSymmetry.symmetry&&i.push({label:e.globalSymmetry.symmetry+" (global)",axes:e.globalSymmetry.symmetryAxes}),e.pseudoSymmetry&&"C1"!==e.pseudoSymmetry.symmetry&&i.push({label:e.pseudoSymmetry.symmetry+" (pseudo)",axes:e.pseudoSymmetry.symmetryAxes}),i.length>0&&(t[o]={symmetries:i})}),t}function Pe(e){var t,o,i=e.structure,a=i.biomolDict;if(a.BU1){var n=a.BU1;t=n.getAtomCount(i),o=n.getInstanceCount()}else t=i.getModelProxy(0).atomCount,o=1;return{atomCount:t,instanceCount:o}}function De(e,t,o){var i=e;return t&&(i*=4),o&&(i*=10),i}function je(e,t,o){var i=Math.min(1.5,Math.max(.1,2e3/(e/t)));return o&&(i=Math.min(i,.15)),i}var Me="SET_VIEW",Ue="SET_STRUCTURE_VIEW",Ge="SET_ASSEMBLY",qe="SET_MODEL",We="SET_SYMMETRY",Ye="SET_STYLE",He="SET_COLOR_SCHEME",Ke="SET_LIGAND_STYLE",Qe="SET_QUALITY",Ze="SET_WATER_VISIBILITY",Je="SET_ION_VISIBILITY",Xe="SET_HYDROGEN_VISIBILITY",$e="SET_CLASH_VISIBILITY",et="SET_DEFAULT_STRUCTURE_VIEW",tt="SET_2FOFC",ot="SET_FOFC",it="SET_SCROLL",at="SET_2FOFC_LEVEL",nt="SET_FOFC_LEVEL",rt="SET_MAP_STYLE",lt="SET_BOX_SIZE",st="SET_EDMAPS_LIGAND",ct="SET_DEFAULT_EDMAPS_VIEW",ut="SET_LIGAND",dt="SET_POCKET_OPACITY",pt="SET_POCKET_NEAR_CLIPPING",ft="SET_POCKET_RADIUS_CLIPPING",ht="SET_LIGAND_LABEL",yt="SET_POLYMER_DISPLAY",mt="SET_DEFAULT_LIGAND_VIEW",bt="SET_POCKET_COLOR",gt="SET_HYDROGEN_BOND",vt="SET_HALOGEN_BOND",St="HYDROPHOBIC",kt="SET_PI_INTERACTION",Ct="SET_METAL_COORDINATION",wt="SET_SPIN",_t="CENTER",Nt="SET_FULLSCREEN",Vt="SCREENSHOT",Et="SET_FOCUS",Tt="SET_CAMERA_TYPE",Ot="SET_BACKGROUND",It="structureView",Ft="edmapsView",xt="ligandView",Rt="viewer",Lt="//files.rcsb.org/pub/pdb/validation_reports/",Bt="_validation.xml.gz",At="//edmaps.rcsb.org/maps/",zt=1,Pt=250,Dt=1.5,jt=3,Mt=20,Ut={assembly:"View structure as asymmetric unit, biological assembly, unit cell, or stacked unit cells",symmetry:"View intrinsic molecular symmetry",model:"View specific model for multi-model structure",style:"View the structure in different presentation styles",colorScheme:"Color the structure using different schemes",ligandStyle:"Change ligand presentation style",quality:"Adjust rendering quality",water:"Show/hide water molecules",ion:"Show/hide ions",hydrogen:"Show/hide hydrogen atoms",clash:"Show/hide clashes between atoms (indicated by pink disks) as specified in the Validation Report",btnDefaultStructureView:"Reset to the default structure view",map:"Select the map to display, 2fo-fc (blue), fo-fc (positive: green, negative: red)",scroll:'Select the map whose ISO level will be changed via "Ctrl scroll-wheel"',level2fofc:"The ISO level of the 2fo-fc map",levelFofc:"The ISO level of the fo-fc map",mapStyle:"Change the display style of the map",boxSize:"The Map Size in Ångströms",ligandEdmaps:"Select the ligand to display",btnDefaultMapsView:"Set the Electron Density Maps to the default view",ligandViewLigand:"Select the ligand to display",pocketOpacity:"Adjust the opacity of the ligand pocket from 0 - 100 percent",pocketNearClipping:"Adjust the clipping of the ligand pocket",pocketRadiusClipping:"Adjust the radious clipping of the ligand pocket",pocketColor:"Color the pocket surface using different schemes",hydrogenBond:"Show/hide hydrogen bonds. Donor and acceptor atoms within 3.5 Angstrom.",halogenBond:"Show/hide halogen bonds. Candidate halogens atoms within 4.0 Angstrom of acceptor atoms.",hydrophobic:"Show/hide hydrophobic interactions. Generally hydrocarbon and fluorine atoms within 4.0 Angstrom.",piInteraction:"Show/hide cation-pi and pi-stacking interactions. Complexes of aromatic rings and positive charges.",metalCoordination:"Show/hide metal interactions. Dative bonds and ionic/ionic-type interactions involving metals.",label:"Display labels for the ligand",polymerDisplay:"Show or hide the current polymer display",btnDefaultLigandView:"Set the default ligand view",spin:"Start/stop spinning the structure along the y-axis",center:"Reset molecule position",fullscreen:"Activate/disable fullscreen mode",screenshot:"Download screenshot at twice the displayed resolution",focus:"Move far and near clipping planes towards the center"},Gt="reducers.js",qt={},Wt="structure-view.js",Yt=function(e,t){var o,i=Object.assign({},t),a=new NGL.Color(i.color||"lime"),n=i.radius||te(e[0]),r=new NGL.Shape("symmetry",{disableImpostor:!1,openEnded:!0});e.forEach(function(e){r.addSphere(e.start,a,n),r.addSphere(e.end,a,n),r.addCylinder(e.start,e.end,a,n)}),this.attach=function(e){o=e.addBufferRepresentation(r.getBufferList())},this.dispose=function(){o&&o.dispose()}},Ht={},Kt={contour:{contour:!0,flatShaded:!1,opacity:1,metalness:0,wireframe:!1,depthWrite:!0},smooth:{contour:!1,flatShaded:!1,opacity:.5,metalness:0,wireframe:!1,depthWrite:!1},flat:{contour:!1,flatShaded:!0,opacity:.3,metalness:.2,wireframe:!1,depthWrite:!1}},Qt=function(e){return{type:Me,value:e}},Zt=function(e){return{type:Ge,value:e}},Jt=function(e){return{type:qe,value:e}},Xt=function(e){return{type:We,value:e}},$t=function(e){return{type:Ye,value:e}},eo=function(e){return{type:He,value:e}},to=function(e){return{type:Ke,value:e}},oo=function(e){return{type:Qe,value:e}},io=function(e){return{type:Ze,value:e}},ao=function(e){return{type:Je,value:e}},no=function(e){return{type:Xe,value:e}},ro=function(e){return{type:$e,value:e}},lo=function(){return{type:et}},so=function(e){return{type:tt,value:e}},co=function(e){return{type:ot,value:e}},uo=function(e){return{type:it,value:e}},po=function(e){return{type:at,value:e}},fo=function(e){return{type:nt,value:e}},ho=function(e){return{type:rt,value:e}},yo=function(e){return{type:lt,value:e}},mo=function(){return{type:ct}},bo=function(e){return{type:st,value:e}},go=function(e){return{type:ut,value:e}},vo=function(e){return{type:pt,value:e}},So=function(e){return{type:ft,value:e}},ko=function(e){return{type:dt,value:e}},Co=function(e){return{type:bt,value:e}},wo=function(e){return{type:gt,value:e}},_o=function(e){return{type:vt,value:e}},No=function(e){return{type:St,value:e}},Vo=function(e){return{type:kt,value:e}},Eo=function(e){return{type:Ct,value:e}},To=function(e){return{type:ht,value:e}},Oo=function(e){return{type:yt,value:e}},Io=function(){return{type:mt}},Fo=function(){return{type:wt}},xo=function(){return{type:_t}},Ro=function(){return{type:Nt}},Lo=function(){return{type:Vt}},Bo=function(e){return{type:Tt,value:e}},Ao=function(e){return{type:Ot,value:e}},zo=function(e){return{type:Et,value:e}},Po=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.onChange,i=t.action,a=t.label,n=t.id,r=t.options,l=t.selected;return e.h("div",{className:"row horiz-group"},e.h("div",{className:"col-xs-5 label-right"},e.h(Ko,{label:a,id:n})),e.h("div",{className:"col-xs-7"},e.h(Do,{onChange:o,action:i,id:n,options:r,selected:l})))},o}(e.Component),Do=function(t){function o(e){t.call(this,e),this.onChange=e.onChange,this.action=e.action}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleChange=function(e){this.onChange(this.action(e.target.value))},o.prototype.render=function(){var t=this.props,o=t.id,i=t.options,a=t.selected,n=Le(o,i);return e.h("select",{onChange:this.handleChange.bind(this),className:"form-control input-sm",id:"select-"+o,value:a},n)},o}(e.Component),jo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.option;return e.h("option",{value:o.value},o.label)},o}(e.Component),Mo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.onClick,i=t.action,a=t.label,n=t.id,r=t.checked;return e.h("div",{className:"checkbox-group"},e.h(Ko,{label:a,id:n}),e.h(Uo,{id:n,checked:r,className:"checkbox-with-label",onClick:o,action:i}))},o}(e.Component),Uo=function(t){function o(e){t.call(this,e),this.onClick=e.onClick,this.action=e.action}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleClick=function(e){this.onClick(this.action(e.target.checked))},o.prototype.render=function(){
var t=this.props,o=t.checked,i=t.id,a=t.className;return e.h("input",{type:"checkbox",onClick:this.handleClick.bind(this),checked:o,id:"checkbox-"+i,className:a})},o}(e.Component),Go=function(t){function o(e){t.call(this,e),this.onClick=e.onClick,this.action=e.action}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleClick=function(e){this.onClick(this.action(e.target.value))},o.prototype.render=function(){var t=this.props,o=t.id,i=t.name,a=t.value,n=t.checked;return e.h("input",{type:"radio",id:"radio-"+o,name:i,value:a,onClick:this.handleClick.bind(this),checked:n,className:"ngl-ui-radio"})},o}(e.Component),qo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.label,i=t.onInput,a=t.action,n=t.id,r=t.attrs,l=t.disabled,s=6,c=6;this.props.rangeColWidth&&(c=this.props.rangeColWidth,s=12-c);var u=l?{opacity:.5}:null;return e.h("div",{className:"row horiz-group",style:u},e.h("div",{className:"col-xs-"+s+" label-right"},e.h(Ko,{label:o,id:n})),e.h("div",{className:"col-xs-"+c},e.h(Wo,{onInput:i,action:a,id:n,attrs:r,disabled:l})))},o}(e.Component),Wo=function(t){function o(e){t.call(this,e);var o=this.props,i=o.id,a=o.onInput,n=o.action,r=o.attrs;this.id=i,this.onInput=a,this.action=n,this.min=r&&r.min?r.min:0,this.max=r&&r.max?r.max:100,this.step=r&&r.step?r.step:1;var l=r&&r.value?r.value:0;this.state.value="level2fofc"===i||"levelFofc"===i?l.toFixed(1):l,ii.components[i]=this}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleInput=function(e){var t="level2fofc"===this.id||"levelFofc"===this.id?parseFloat(e.target.value).toFixed(1):parseInt(e.target.value);this.setState({value:t}),this.onInput(this.action(t))},o.prototype.render=function(){var t=this.state,o=t.value,i=this.props,a=i.disabled,n=this,r=n.id,l=n.max,s=n.min,c=n.step,u="level2fofc"===r||"levelFofc"===r?8:o<10?4:6,d=ii[r+"Width"]?9+(ii[r+"Width"]-18)*o/l-u:1,p={left:d};return e.h("div",{className:"inputRange"},e.h("input",{id:r+"Range",type:"range",min:s,max:l,value:o,step:c,onInput:this.handleInput.bind(this),disabled:a}),e.h("div",{id:r+"Value",style:p},o))},o}(e.Component),Yo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.onClick,i=t.action,a=t.name,n=t.id,r=t.cls;return e.h("div",{className:"text-right"},e.h(Ho,{name:a,id:n,cls:r,onClick:o,action:i}))},o}(e.Component),Ho=function(t){function o(e){t.call(this,e),this.onClick=e.onClick,this.action=e.action}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleClick=function(e){this.onClick(this.action())},o.prototype.render=function(){var t=this.props,o=t.name,i=t.id,a=t.cls;return e.h("button",{id:i,className:a||"off",onClick:this.handleClick.bind(this)},e.h("span",null,o),e.h(Qo,{id:i}))},o}(e.Component),Ko=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.label,i=t.id;return e.h("span",null,o,e.h(Qo,{id:i}))},o}(e.Component),Qo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props,o=t.id;return e.h("span",{className:"fa fa-question-circle ngl-ui-help","data-toggle":"tooltip","data-placement":"top",title:Ut[o]})},o}(e.Component),Zo=function(t){function o(e){t.call(this,e)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props.store,o=t.getState(),i=o.view===It||2===ii.debug?"display: block":"display: none";return e.h("div",{id:It,className:"controls",style:i},e.h("div",{className:"help-page"},e.h("a",{href:"/docs/3d-viewers/ngl#structure-view",target:"_blank"},"Structure View Documentation")),e.h("br",null),e.h(Po,{label:"Assembly",id:"assembly",options:o.options.assembly,selected:o.assembly,onChange:t.dispatch,action:Zt}),e.h(Po,{label:"Model",id:"model",options:o.options.model,selected:o.model,onChange:t.dispatch,action:Jt}),e.h(Po,{label:"Symmetry",id:"symmetry",options:o.options.symmetry,selected:o.symmetry,onChange:t.dispatch,action:Xt}),e.h(Po,{label:"Style",id:"style",options:o.options.style,selected:o.style,onChange:t.dispatch,action:$t}),e.h(Po,{label:"Color",id:"colorScheme",options:o.options.colorScheme,selected:o.colorScheme,onChange:t.dispatch,action:eo}),e.h(Po,{label:"Ligand",id:"ligandStyle",options:o.options.ligandStyle,selected:o.ligandStyle,onChange:t.dispatch,action:to}),e.h(Po,{label:"Quality",id:"quality",options:o.options.quality,selected:o.quality,onChange:t.dispatch,action:oo}),e.h("div",{className:"row horiz-group"},e.h("div",{className:"col-xs-6"},e.h(Mo,{label:"Water",id:"water",checked:o.waterVisibility?"checked":"",onClick:t.dispatch,action:io})),e.h("div",{className:"col-xs-6"},e.h(Mo,{label:"Ions",id:"ion",checked:o.ionVisibility?"checked":"",onClick:t.dispatch,action:ao}))),e.h("div",{className:"row horiz-group"},e.h("div",{className:"col-xs-6"},e.h(Mo,{label:"Hydrogens",id:"hydrogen",checked:o.hydrogenVisibility?"checked":"",onClick:t.dispatch,action:no})),e.h("div",{className:"col-xs-6"},ii.hasValidationReport&&!ii.reduced&&e.h(Mo,{label:"Clashes",id:"clash",checked:o.clashVisibility?"checked":"",onClick:t.dispatch,action:ro}))),e.h("div",{className:"text-right"},e.h(Ho,{name:"Default Structure View",id:"btnDefaultStructureView",onClick:t.dispatch,action:lo})))},o}(e.Component),Jo=function(t){function o(e){t.call(this,e)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props.store,o=t.getState(),i=o.view===Ft||2===ii.debug?"display: block":"display: none",a={max:10,value:o.level2fofc,step:.1},n={max:10,value:o.levelFofc,step:.1},r={value:o.boxSize};return ii.hasEdmaps?e.h("div",{id:Ft,className:"controls",style:i},e.h("div",{className:"help-page"},e.h("a",{href:"/docs/3d-viewers/ngl#electron-density-maps",target:"_blank"},"Electron Density Maps Documentation")),e.h("br",null),e.h("div",{className:"row edmaps"},e.h("div",{className:"col-xs-5"}),e.h("div",{className:"col-xs-3 map-name"},"2fo-fc"),e.h("div",{className:"col-xs-3 map-name"},"fo-fc")),e.h("div",{className:"row edmaps"},e.h("div",{className:"col-xs-5 label-right"},e.h(Ko,{label:"Map",id:"map"})),e.h("div",{className:"col-xs-3"},e.h(Uo,{id:"2fofc",checked:o.map2fofc,onClick:t.dispatch,action:so})),e.h("div",{className:"col-xs-3"},e.h(Uo,{id:"fofc",checked:o.mapFofc,onClick:t.dispatch,action:co}))),e.h("div",{className:"row edmaps"},e.h("div",{className:"col-xs-5 label-right"},e.h(Ko,{label:"Scroll",id:"scroll"})),e.h("div",{className:"col-xs-3"},e.h(Go,{id:"scroll-2fofc",name:"scroll",checked:"2fofc"===o.scroll,value:"2fofc",onClick:t.dispatch,action:uo})),e.h("div",{className:"col-xs-3"},e.h(Go,{id:"scroll-fofc",name:"scroll",checked:"fofc"===o.scroll,value:"fofc",onClick:t.dispatch,action:uo}))),e.h(qo,{label:"2fo-fc Level",id:"level2fofc",onInput:t.dispatch,action:po,rangeColWidth:"7",attrs:a,disabled:!o.map2fofc}),e.h(qo,{label:"fo-fc Level",id:"levelFofc",onInput:t.dispatch,action:fo,rangeColWidth:"7",attrs:n,disabled:!o.mapFofc}),e.h("div",{className:"vspace-20"}),e.h(Po,{label:"Map Style",id:"mapStyle",options:o.options.mapStyle,selected:o.mapStyle,onChange:t.dispatch,action:ho}),e.h(qo,{label:"Map Size",id:"boxSize",onInput:t.dispatch,action:yo,rangeColWidth:"7",attrs:r,disabled:!(o.map2fofc||o.mapFofc)}),ii.hasLigand&&e.h(Po,{label:"Ligand",id:"ligandEdmaps",options:o.options.ligand,selected:o.ligand,onChange:t.dispatch,action:bo}),e.h("div",{className:"vspace-20"}),e.h(Yo,{name:"Default EDMaps View",id:"btnDefaultMapsView",onClick:t.dispatch,action:mo})):e.h("div",{id:Ft,className:"controls",style:i},e.h("div",{className:"help-page"},e.h("a",{href:"/docs/3d-viewers/ngl#electron-density-maps",target:"_blank"},"Electron Density Maps Documentation")),e.h("br",null),e.h("div",{class:"message"},"There are no electron density maps for structure "+pdbidUc))},o}(e.Component),Xo={begin:"To begin select a ligand from the dropdown list.",pocket:"The ligand pocket is only visible if the opacity is set to greater than zero."},$o=function(t){function o(e){t.call(this,e)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props.store,o=t.getState(),i=o.view===xt||2===ii.debug?"display: block":"display: none";if(2===ii.debug&&(i+="; position: absolute; left: 275px; top: 46px; width: 262px;"),ii.hasLigand){var a=""===o.ligand?Xo.begin:Xo.pocket,n={value:o.pocketRadiusClipping};return e.h("div",{id:xt,className:"controls",style:i},e.h("div",{className:"help-page"},e.h("a",{href:"/docs/3d-viewers/ngl#ligand-viewer-options",target:"_blank"},"Ligand View Documentation")),e.h("br",null),e.h("div",{id:"ligandViewMessage",className:"message"},a),e.h(Po,{label:"Ligand",id:"ligandViewLigand",options:o.options.ligand,selected:o.ligand,onChange:t.dispatch,action:go}),e.h("div",{id:"ligandViewControls",style:""===o.ligand?"display: none;":"display: block;"},e.h("hr",null),e.h("div",{className:"pocketLabel"},"Pocket"),e.h(qo,{label:"Opacity",id:"pocketOpacity",onInput:t.dispatch,action:ko,disabled:!1}),e.h(qo,{label:"Near Clipping",id:"pocketNearClipping",onInput:t.dispatch,action:vo,disabled:!1}),e.h(qo,{label:"Radius Clipping",id:"pocketRadiusClipping",onInput:t.dispatch,attrs:n,action:So,disabled:!1}),e.h("div",{className:"vspace-10"}),e.h(Po,{label:"Color",id:"pocketColor",options:o.options.pocketColor,selected:o.pocketColor,onChange:t.dispatch,action:Co}),e.h("hr",null),e.h(Mo,{label:"Hydrogen Bonds (blue)",id:"hydrogenBond",checked:o.hydrogenBond?"checked":"",onClick:t.dispatch,action:wo}),e.h(Mo,{label:"Halogen Bonds (turquoise)",id:"halogenBond",checked:o.halogenBond?"checked":"",onClick:t.dispatch,action:_o}),e.h(Mo,{label:"Hydrophobic Contacts (grey)",id:"hydrophobic",checked:o.hydrophobic?"checked":"",onClick:t.dispatch,action:No}),e.h(Mo,{label:"Pi Interactions (orange, green)",id:"piInteraction",checked:o.piInteraction?"checked":"",onClick:t.dispatch,action:Vo}),e.h(Mo,{label:"Metal Interactions (purple)",id:"metalCoordination",checked:o.metalCoordination?"checked":"",onClick:t.dispatch,action:Eo}),e.h("div",{className:"vspace-10"}),e.h(Mo,{label:"Label",id:"label",onClick:t.dispatch,checked:o.label?"checked":"",action:To}),e.h(Mo,{label:"Polymer Display",id:"polymerDisplay",onClick:t.dispatch,checked:o.polymerDisplay?"checked":"",action:Oo}),e.h("div",{className:"vspace-10"})),e.h(Yo,{name:"Default Ligand View",id:"btnDefaultLigandView",onClick:t.dispatch,action:Io}))}var r="There are no ligands to view for structure "+pdbidUc;return e.h("div",{id:xt,className:"controls",style:i},e.h("div",{class:"message"},r))},o}(e.Component),ei=function(t){function o(e){t.call(this,e),ii.components.nglControls=this}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.handleClick=function(e){console.log("NglControls: e.target.id="+e.target.id),this.props.store.dispatch(Qt(e.target.id.replace("Tab","")))},o.prototype.render=function(){var t=this.props.store,o=t.getState().view;return e.h("div",null,e.h("div",{id:"controls-tabs"},e.h("div",{id:It+"Tab",className:o===It?"tab-active":"tab-inactive",onClick:this.handleClick.bind(this)},"Structure",e.h("br",null),"View"),e.h("div",{id:Ft+"Tab",className:o===Ft?"tab-active":"tab-inactive",onClick:this.handleClick.bind(this)},"Electron",e.h("br",null),"Density Maps"),e.h("div",{id:xt+"Tab",className:o===xt?"tab-active":"tab-inactive",onClick:this.handleClick.bind(this)},"Ligand",e.h("br",null),"View")),e.h(Zo,{store:t}),e.h(Jo,{store:t}),e.h($o,{store:t}))},o}(e.Component),ti=function(t){function o(e){t.call(this,e),ii.components.viewer=this}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.render=function(){var t=this.props.store,o=t.getState();return e.h("div",null,e.h(Ho,{name:"Spin",id:"spin",onClick:t.dispatch,action:Fo,cls:o.spin?"on":"off"}),e.h(Ho,{name:"Center",id:"center",onClick:t.dispatch,action:xo}),!ii.isSafariMobile&&e.h("span",null,e.h(Ho,{name:"Fullscreen",id:"fullscreen",onClick:t.dispatch,action:Ro,cls:o.fullscreen?"on":"off"}),e.h(Ho,{name:"Screenshot",id:"screenshot",onClick:t.dispatch,action:Lo})),e.h("div",{className:"inline"},e.h(Do,{id:"cameraType",options:o.options.cameraType,selected:o.cameraType,onChange:t.dispatch,action:Bo})),e.h("div",{className:"inline"},e.h(Do,{id:"background",options:o.options.background,selected:o.background,onChange:t.dispatch,action:Ao})),e.h("div",{className:"inline"},e.h("div",{className:"inline viewer-focus-label"},e.h(Ko,{label:"Focus",id:"focus"})),e.h("div",{className:"inline viewer-focus-slider"},e.h(Wo,{id:"focus",onInput:t.dispatch,action:zo}))))},o}(e.Component),oi="ngl-ui.jsx";console.log(oi+": NGL.Version="+NGL.Version);var ii={};return initNglUi=function(){console.log(oi+": initNglUi: "+(Date.now()-startTime)+"ms after startTime"),stage.loadFile(blob,{ext:"mmtf",defaultRepresentation:!1}).then(function(e){var t=structureData,i=e.structure,a=i.biomolDict,n=ze(t.symmetry),s=t.hasEdMaps,c=t.hasValidationReport,u=!i.unitcell&&1===Object.keys(a).length&&a.BU1&&a.BU1.isIdentity(i),d=u?"BU1":o(bionumber),p=Pe(e),f=p.atomCount,h=p.instanceCount,y=i.atomStore.count/i.residueStore.count<2,S="undefined"!=typeof window&&void 0!==window.orientation,k=navigator.userAgent,w=-1!==k.indexOf("AppleWebKit")&&(-1!==k.indexOf("iPhone")||-1!==k.indexOf("iPad")),_=De(f,S,y),N=je(_,h,y);e.defaultAssembly=d,console.log(oi+": initNglUi: sc.defaultAssembly="+e.defaultAssembly+" ("+d+")"),Object.assign(ii,{preset:preset,sele:sele,debug:debug,reduced:reduced,sc:e,init:!0,symmetryData:n,hasEdmaps:s,hasValidationReport:c,isFullStructure:u,isSafariMobile:w,sizeScore:_,scaleFactor:N}),ii.components={},ii.initStateStructureView={assembly:d,model:0,symmetry:-1,style:r(_),colorScheme:l(_),ligandStyle:"ballandstick",quality:"auto",waterVisibility:!1,ionVisibility:!0,hydrogenVisibility:!0,clashVisibility:!1},ii.initStateEdmaps={map2fofc:!1,level2fofc:0,mapFofc:!1,levelFofc:0,scroll:"",mapStyle:"contour",boxSize:0},ii.initStateLigandView={ligand:"",pocketOpacity:0,pocketNearClipping:0,pocketRadiusClipping:100,pocketColor:"hydrophobicity",hydrogenBond:!0,halogenBond:!0,hydrophobic:!0,piInteraction:!0,metalCoordination:!0,label:!0,polymerDisplay:!1},ii.initStateViewer={spin:!1,fullscreen:!1,focus:0,cameraType:"perspective",background:"white"};var V=C(d);ii.hasLigand=V.ligand.length>0,H();var E=Object.assign(m(),{options:V,view:It});"symmetry"===preset?(sele&&""!==sele||(sele=g(V.symmetry)),E.symmetry=b(V.symmetry,sele),Be(E)):"validationReport"===preset&&ii.hasValidationReport?(E.clashVisibility=!0,E.colorScheme="geoquality",K(E,stage,Be)):"ligandInteraction"===preset&&ii.hasLigand?(E.ligand=""===sele?V.ligand[1].value:v(V.ligand,sele),E.view=xt,Be(E)):"electronDensityMaps"===preset&&ii.hasEdmaps?(E.view=Ft,Be(E)):Be(E)})},resizeNglUi=function(e,t){ii[e+"Width"]=parseInt(t),ii.components[e]&&ii.components[e].setState()},ii});
